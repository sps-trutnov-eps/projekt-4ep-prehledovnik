<!DOCTYPE html>
<%- include('../partials/head'); %>
<style>
   .grid-container {
     display: grid;
     grid-template-columns: auto auto auto auto auto auto auto auto auto auto auto;
     padding: 10px;
   }
   .grid-item {
     border: 1px solid rgba(0, 0, 0, 0.8);
     padding-inline: 15px;
     padding-block: 45px;
     margin: 0;
     font-size: 18px;
     text-align: center;
   }
   .grid-item-h {
      border: 1px solid rgba(0, 0, 0, 0.8);
      padding: 15px;
      margin: 0;
      font-size: 18px;
      text-align: center;
   }
   .cislo-hodiny {
      color: #0172ad;
      font-size: 20px;
      font-weight: bold;
   }
   .den-tydne {
     padding-inline: 0;
     padding-block: 30px;
     text-align: center;
   }
</style>
<article style="flex: 3; overflow-y: auto; padding: 0;">
  <header>
    <nav>
      <ul>
        <li>
          <h1>Kalendář</h1>
        </li>
      </ul>
      <ul>
        <li>
          <div role="group">
            <button hx-get="/kalendar/tydenni" hx-target="body" hx-push-url="true" hx-swap="transition:true">
                Týdenní
            </button>
            <button class="outline" hx-get="/kalendar" hx-target="body" hx-push-url="true" hx-swap="transition:true">
                Měsíční
            </button>
          </div>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <div>
      <% let Weeks = week.length %>
      
      <!-- výpočet prvního pondělí v roce -->
      <% 
      function getFirstMondayOfSeptember(year) {
        let date = new Date(year, 8, 1);
        while (date.getDay() !== 1) {
          date.setDate(date.getDate() + 1);
        }
        return date;
      }
    
      let baseDate = getFirstMondayOfSeptember(2024);
      %>

      <%
      let periodNumbers = {};
      %>

      <% for(let t=0;t<Weeks;t++ ) {%>
        <section class="grid-container">
          <p class="grid-item-h"><%= week[t] %></p>
          <p class="grid-item-h"><span class="cislo-hodiny">0</span><br>7:10-7:55</p>
          <p class="grid-item-h"><span class="cislo-hodiny">1</span><br>8:00-8:45</p>
          <p class="grid-item-h"><span class="cislo-hodiny">2</span><br>8:50-9:35</p>
          <p class="grid-item-h"><span class="cislo-hodiny">3</span><br>9:55-10:40</p>
          <p class="grid-item-h"><span class="cislo-hodiny">4</span><br>10:50-11:35</p>
          <p class="grid-item-h"><span class="cislo-hodiny">5</span><br>11:40-12:25</p>
          <p class="grid-item-h"><span class="cislo-hodiny">6</span><br>12:35-13:20</p>
          <p class="grid-item-h"><span class="cislo-hodiny">7</span><br>13:25-14:10</p>
          <p class="grid-item-h"><span class="cislo-hodiny">8</span><br>14:15-15:00</p>
          <p class="grid-item-h"><span class="cislo-hodiny">9</span><br>15:00+</p>
          <% let days = ["Po", "Ut", "St", "Ct", "Pa"] %>
          <% let day = ["Po"] %>
          
          <% for(let i=0;i<5;i++) {%>
            <% let currentDate = new Date(baseDate) %>
            <% currentDate.setDate(baseDate.getDate() + (t * 7) + i) %>
            
            <% let formattedDate = `${currentDate.getDate()}.${currentDate.getMonth() + 1}.` %>
            <p class="grid-item den-tydne">
              <span class="cislo-hodiny"><%= days[i] %></span><br>
              <span><%= formattedDate %></span>
            </p>
            <% for(let j=0;j<= 9;j++) {%>
              <% let key%>
              <div class="grid-item">
                <% if (week[t] % 2 === 0) { %>
                  <p class="room"><%= rozvrh.hodiny.sudy[days[i]][j].mistnost%></p>
                  <p class="period"><%= rozvrh.hodiny.sudy[days[i]][j].predmet%></p>
                  <p class="group"><%= rozvrh.hodiny.sudy[days[i]][j].skupina%></p>
                  <p class="class"><%= rozvrh.hodiny.sudy[days[i]][j].trida%></p>
                  <%
                    if( rozvrh.hodiny.sudy[days[i]][j].predmet != "volno"){
                      key = rozvrh.hodiny.sudy[days[i]][j].predmet+rozvrh.hodiny.sudy[days[i]][j].trida + rozvrh.hodiny.sudy[days[i]][j].skupina
                      if (!(key in periodNumbers))
                        periodNumbers[key] = 1
                    }
                  %>
                <% }%>
                <% if (week[t] % 2 === 1) { %>
                  <p class="room"><%= rozvrh.hodiny.lichy[days[i]][j].mistnost%></p>
                  <p class="period"><%= rozvrh.hodiny.lichy[days[i]][j].predmet%></p>
                  <p class="group"><%= rozvrh.hodiny.lichy[days[i]][j].skupina%></p>
                  <p class="class"><%= rozvrh.hodiny.lichy[days[i]][j].trida%></p>
                  <%            
                    if( rozvrh.hodiny.lichy[days[i]][j].predmet != "volno"){
                      key = rozvrh.hodiny.lichy[days[i]][j].predmet+rozvrh.hodiny.lichy[days[i]][j].trida + rozvrh.hodiny.lichy[days[i]][j].skupina
                      if (!(key in periodNumbers))
                        periodNumbers[key] = 1
                    }              
                  %>
                <% }%>
                <%if(key != null){ let altKey = key.replace(new RegExp("cela|sk1|sk2", "g"), "")%>
                  <p class="count"><%= periodNumbers[key]%></p>
                  <%if(osnovy[altKey] != undefined){ %>
                    <p class="theme"><%- osnovy[altKey][periodNumbers[key]-1] %></p>   
                  <% }%>  
                  <% periodNumbers[key] += 1 %>
                <% }%>
                </div>
            <%}%>
          <%} %>
        </section>
      <%}%>
    </div>
  </main>
</article>



<script>
  
</script>



<%- include('../partials/tail') %>
